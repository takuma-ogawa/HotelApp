{"remainingRequest":"C:\\Users\\takum\\Documents\\hokuriku_tosbac\\HotelApp\\project\\HotelApp\\HotelApp\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\takum\\Documents\\hokuriku_tosbac\\HotelApp\\project\\HotelApp\\HotelApp\\src\\pages\\RollCallStatus.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\takum\\Documents\\hokuriku_tosbac\\HotelApp\\project\\HotelApp\\HotelApp\\src\\pages\\RollCallStatus.vue","mtime":1607356260360},{"path":"C:\\Users\\takum\\Documents\\hokuriku_tosbac\\HotelApp\\project\\HotelApp\\HotelApp\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\takum\\Documents\\hokuriku_tosbac\\HotelApp\\project\\HotelApp\\HotelApp\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\takum\\Documents\\hokuriku_tosbac\\HotelApp\\project\\HotelApp\\HotelApp\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// @ is an alias to /src\nimport Card from '@/components/Card/Card.vue'\nimport config from '@/config.js'\nimport ElIncrementSearch from '@/components/IncrementSearch.vue'\nimport arrayFunction from '@/js/array.js'\nimport url from '@/js/api_url.js'\nimport time from '@/js/status/time.js'\n\n\nexport default {\n    name: 'niukeSyukei',\n    components: {\n        Card, ElIncrementSearch\n    },\n    data: function () {\n        return {\n            data: {\n                search: {\n                    model: {\n                        memberName: \"\",\n                        ServiceDate: \"\",\n                        IsLongDistance: \"\",\n                        IsAlert: false,\n                        NarrowDestination: \"all\",\n                        selectedDrivers: [],\n                    },\n                    validation: {\n                        memberName: [\n                            { required: true, message: '社員名が入力されていません', trigger: 'blur' },\n                        ],\n                    }\n                },\n                AlertColor: {\n                    0: \"\",\n                    1: \"\",\n                    2: \"\",\n                },\n                drivers: [],\n                destinations: [],\n                meisai: [],\n                isSave: false,\n            },\n        }\n    },\n    methods: {\n\n        moveRollCallInput: function (meisai_data) {\n\n            if (window.confirm(\"変更が保存されませんがよろしいですか？\")) {\n\n                this.$store.commit('changeMoveRollCallLogInput', { ServiceDate: meisai_data.ServiceLog.ServiceDate, MemberID: meisai_data.ServiceLog.DriverID });\n\n                this.$router.push('/uedaunyu/rollCallLogInput');\n\n            }\n        },\n        getAlertColor: function (meisai_data) {\n\n            var alertKind = meisai_data.AlertKind;\n\n            if (meisai_data.IsDelete) {\n\n                return \"background-color:#a9a9a9;\"\n\n            } else {\n                if (alertKind == 0 || alertKind == 1 || alertKind == 2) {\n\n                    return \"background-color:\" + this.data.AlertColor[alertKind] + \";\";\n\n                } else {\n\n                    return \"\";\n                }\n            }\n\n           \n\n        },\n        getDriversIndex: function (DriverID) {\n\n            for (var i = 0; i < this.data.drivers.length; i++) {\n\n                if (this.data.drivers[i].MemberID == DriverID) {\n                    return i;\n                }\n            }\n\n\n        },\n        getDriver: function (DriverID) {\n\n            return this.data.drivers[this.getDriversIndex(DriverID)];\n        },\n        addServiceLogAllDrivers: function () {\n\n            for (var i = 0; i < this.data.drivers.length; i++) {\n\n                var driver = this.data.drivers[i];\n\n                console.log(driver);\n\n                this.addServiceLog(driver.IsLongDistance, driver.DestinationID, -1, driver.MemberID,this.data.search.model.ServiceDate, driver.MemberName, \"\", \"\", \"\");\n\n            }\n\n        },\n        addServiceLogBySelectedDrivers: function () {\n\n            for (var i = 0; i < this.data.search.model.selectedDrivers.length; i++) {\n\n                var driverID = this.data.search.model.selectedDrivers[i];\n\n                for (var k = 0; k < this.data.drivers.length; k++) {\n\n                    var driver = this.data.drivers[k];\n\n                    if (driver.MemberID == driverID) {\n\n                        this.addServiceLog(driver.IsLongDistance, driver.DestinationID, -1, driver.MemberID, this.data.search.model.ServiceDate, driver.MemberName, \"\", \"\", \"\");\n                    }\n                    \n                }\n\n            }\n\n\n        },\n        addServiceLog: function (IsLongDistance, DestinationID, ServiceLogID, DriverID, ServiceDate, MemberName, BeforDrivingRollCallTime, LastRollCallTime, AfterDrivingRollCallTime) {\n\n            this.data.meisai.push(this.createServiceLog(IsLongDistance, DestinationID, ServiceLogID, DriverID, ServiceDate, MemberName, BeforDrivingRollCallTime, LastRollCallTime, AfterDrivingRollCallTime));\n\n            console.log(this.data.meisai);\n            \n        },\n        createServiceLog: function (IsLongDistance, DestinationID, ServiceLogID, DriverID, ServiceDate, MemberName, BeforDrivingRollCallTime, LastRollCallTime, AfterDrivingRollCallTime) {\n\n\n            var Visibility = this.createVisibilityObject();\n\n            return {\n                IsLongDistance: IsLongDistance,\n                Visibility: Visibility,\n                IsDelete: false,\n                IsEdit: false,\n                AlertKind: null,\n                ServiceLog: {\n                    DestinationID: DestinationID,\n                    CompanyID: this.data.companyID,\n                    EditorID: this.data.editorID,\n                    ServiceLogID: ServiceLogID,\n                    DriverID: DriverID,\n                    ServiceDate: ServiceDate,\n                    MemberName: MemberName,\n                    BeforDrivingRollCallTime: BeforDrivingRollCallTime,\n                    LastRollCallTime: LastRollCallTime,\n                    AfterDrivingRollCallTime: AfterDrivingRollCallTime,\n\n                }\n            }\n        },\n        createVisibilityObject: function () {\n\n            return {\n                IsLongDistance: true,\n                MemberName: true,\n                IsAlert: true,\n                IsDecidedDestination: true,\n            }\n        },\n        changeVisibilityIsLongDistance: function () {\n\n            var isLongDistance = this.data.search.model.IsLongDistance;\n            for (var i = 0; i < this.data.meisai.length; i++) {\n\n                if (!this.data.meisai[i].IsDelete) {\n\n                    var visibility = true;\n\n                    if (isLongDistance != null) {\n\n                        if (this.data.meisai[i].IsLongDistance != isLongDistance) {\n                            visibility = false;\n                        }\n                    }\n\n                    this.data.meisai[i].Visibility.IsLongDistance = visibility;\n                }\n\n            }\n\n        },\n        changeVisibilityIsAlert: function () {\n\n            var isAlert = this.data.search.model.IsAlert;\n\n            for (var i = 0; i < this.data.meisai.length; i++) {\n                if (!this.data.meisai[i].IsDelete) {\n\n                    var visibility = true;\n\n                    if (isAlert) {\n\n                        if (this.data.meisai[i].AlertKind == null) {\n                            visibility = false;\n\n                        }\n                    }\n\n                    this.data.meisai[i].Visibility.IsAlert = visibility;\n                }\n            }\n\n        },\n        changeVisibilityMemberName: function () {\n\n            var memberName = this.data.search.model.memberName;\n\n            for (var i = 0; i < this.data.meisai.length; i++) {\n                if (!this.data.meisai[i].IsDelete) {\n\n                    var visibility = true;\n\n                    if (memberName != \"\") {\n\n                        if (this.data.meisai[i].ServiceLog.MemberName.indexOf(memberName) == -1) {\n\n                            visibility = false;\n\n                        }\n                    }\n\n                    this.data.meisai[i].Visibility.MemberName = visibility;\n                }\n            }\n\n        },\n        changeVisibilityDestination: function () {\n\n            var destination = this.data.search.model.NarrowDestination;\n\n            for (var i = 0; i < this.data.meisai.length; i++) {\n                if (!this.data.meisai[i].IsDelete) {\n\n                    var visibility = true;\n\n                    if (destination != \"all\") {\n\n                        var destinationID = this.data.meisai[i].ServiceLog.DestinationID;\n\n                        if (destination == \"unDecided\") {\n                            if (destinationID != null) {\n                                visibility = false;\n                            }\n                        } else if (destination == \"decided\") {\n                            if (destinationID == null) {\n                                visibility = false;\n                            }\n                        }\n                    }\n\n                    this.data.meisai[i].Visibility.IsDecidedDestination = visibility;\n                }\n            }\n\n        },\n\n\n        judgeDisplayServiceLog: function (visibility) {\n\n            var result = true;\n\n            for (var i in visibility) {\n\n                if (!visibility[i]) {\n                    result = false;\n                }\n\n            }\n            return result\n        },\n        serviceLogSearch: function () {\n\n            axios.get(url.ApiUrl().GetRollCallStatus([{ key: \"CompanyID\", value: this.data.companyID }, { key: \"ServiceDate\", value: this.data.search.model.ServiceDate }]))\n                .then(response => {\n\n                    console.log(response.data);\n                    this.$set(this.data, \"meisai\", response.data);\n\n                    for (var i in this.data.meisai) {\n\n                        this.$set(this.data.meisai[i], \"Visibility\", this.createVisibilityObject());\n\n                        this.$set(this.data.meisai[i].ServiceLog, \"MemberName\", this.getDriver(this.data.meisai[i].ServiceLog.DriverID).MemberName);\n\n                    }\n\n                    console.log(this.data.meisai);\n\n          \n                })\n                .catch(response => {\n                })\n\n\n        },\n        save: function () {\n\n            this.data.isSave = true;\n            axios.put(url.ApiUrl().RollCallStatusSave(), this.data.meisai)\n                .then(response => {\n\n                    console.log(response.data);\n                    if (response.data) {\n\n                        this.$message({\n                            message: '登録に成功しました',\n                            type: 'success'\n                        });\n\n                        this.serviceLogSearch();\n\n                    } else {\n\n                        this.$message({\n                            message: '登録に失敗しました',\n                            type: 'error'\n                        });\n\n                    }\n\n\n                    this.data.isSave = false;\n\n                })\n                .catch(response => {\n\n                    this.$message({\n                        message: '通信に失敗しました',\n                        type: 'error'\n                    });\n\n                    this.data.isSave = false;\n\n                })\n\n        },\n        sendEmail: function () {\n\n            this.data.isSave = true;\n            axios.post(url.ApiUrl().RollCallStatusSendEmail(), this.data.meisai)\n                .then(response => {\n\n                    console.log(response.data);\n                    if (response.data) {\n\n                        this.$message({\n                            message: '登録及び違反者へのメール送信に成功しました',\n                            type: 'success'\n                        });\n\n                        this.serviceLogSearch();\n\n                    } else {\n\n                        this.$message({\n                            message: '登録及び違反者へのメール送信に失敗しました',\n                            type: 'error'\n                        });\n\n                    }\n\n\n                    this.data.isSave = false;\n\n                })\n                .catch(response => {\n\n                    this.$message({\n                        message: '通信に失敗しました',\n                        type: 'error'\n                    });\n\n                    this.data.isSave = false;\n\n                })\n\n        }\n\n\n    },\n    created: function () {\n\n\n        this.data.companyID = this.$store.state.login.companyID;\n        this.data.editorID = this.$store.state.login.userID;\n\n        this.data.search.model.ServiceDate = time.nowJapanDateInput();\n\n        axios.get(url.ApiUrl().GetRollCallStatusMasterData([{ key: \"CompanyID\", value: this.data.companyID }]))\n            .then(response => {\n\n                console.log(response.data.Drivers);\n\n                this.$set(this.data, \"drivers\", response.data.Drivers);\n                this.$set(this.data, \"destinations\", response.data.Destinations);\n\n                this.$set(this.data, \"AlertColor\", response.data.AlertColor);\n\n\n                this.serviceLogSearch();\n\n            })\n            .catch(response => console.log(response))\n\n\n    },\n    mounted: function () {\n\n    },\n    watch: {\n\n    }\n}\n",{"version":3,"sources":["RollCallStatus.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyJA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;;;AAIA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;;AAGA;AACA;;AAEA;;AAEA;;AAEA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;;AAGA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;;AAGA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;;AAGA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;;AAGA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;;AAGA;AACA;;;AAGA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;;AAGA;;AAEA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA","file":"RollCallStatus.vue","sourceRoot":"src/pages","sourcesContent":["<template>\r\n    <div>\r\n        <el-card>\r\n            <div slot='header'>\r\n                <span>点呼状況</span>\r\n            </div>\r\n            <div slot='default'>\r\n                <el-form :model=\"data.search.model\" :rules=\"data.search.validation\" ref=\"searchForm\" label-width=\"120px\">\r\n                    <div class=\"row\">\r\n                        <div class='col-md-3'>\r\n                            <label for='運行日' class='col-form-label px-1' style='width:100%;'>運行日</label>\r\n                            <el-form-item label-width=\"0\" prop=\"ServiceDate\">\r\n                                <el-input type=\"date\"\r\n                                          style='width:100%;'\r\n                                          v-model=\"data.search.model.ServiceDate\"\r\n                                          @change=\"serviceLogSearch()\"\r\n                                          ></el-input>\r\n\r\n                            </el-form-item>\r\n                        </div>\r\n                        <div class=\"col-3\">\r\n                            <label for='運行形態選択' class='col-form-label px-1' style='width:100%;'>運行形態選択</label>\r\n                            <el-form-item label-width=\"0\" prop=\"IsLongDistance\">\r\n                                <el-select name=\"name\" v-model=\"data.search.model.IsLongDistance\" placeholder=\"選択してください\" @change=\"changeVisibilityIsLongDistance()\">\r\n                                    <el-option :value=\"null\" label=\"選択しない\"></el-option>\r\n                                    <el-option :value=\"true\" label=\"長距離\"></el-option>\r\n                                    <el-option :value=\"false\" label=\"地場\"></el-option>\r\n                                </el-select>\r\n                            </el-form-item>\r\n                        </div>\r\n                        <div class=\"col-3\">\r\n                            <el-button style='margin-top:13%;width:80%;' type='primary' @click=\"sendEmail()\">更新</el-button>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"row\" style=\"margin-top:2%;\">\r\n                        <div class='col-md-3'>\r\n                            <label for='アラートのみ' class='col-form-label px-1' style='width:100%;'></label>\r\n                            <el-checkbox style=\"margin-left:5%;\" v-model=\"data.search.model.IsAlert\" @change=\"changeVisibilityIsAlert()\">アラートのみ</el-checkbox>\r\n                        </div>\r\n                        <div class='col-md-3'>\r\n                            <label for='社員検索' class='col-form-label px-1' style='width:100%;'>社員名検索</label>\r\n                            <el-form-item label-width=\"0\" prop=\"syoriKubun\">\r\n                                <el-input type='text'\r\n                                          style='width:100%;'\r\n                                          v-model=\"data.search.model.memberName\"\r\n                                          @change=\"changeVisibilityMemberName()\"\r\n                                          ></el-input>\r\n\r\n                            </el-form-item>\r\n                        </div>\r\n                        <div class='col-md-2'>\r\n                            <label for='社員検索' class='col-form-label px-1' style='width:100%;'>運行追加</label>\r\n                            <el-button type='warning' @click=\"addServiceLogAllDrivers()\">全社員分追加</el-button>\r\n                        </div>\r\n                        <div class='col-md-3'>\r\n                            <label for='社員検索' class='col-form-label px-1' style='width:100%;'>社員を指定して追加</label>\r\n                            <el-select name=\"name\" v-model=\"data.search.model.selectedDrivers\" style=\"margin-right:2%\" multiple>\r\n                                <el-option v-for=\"driver in data.drivers\" :value=\"driver.MemberID\" :label=\"driver.MemberName\"></el-option>\r\n                            </el-select>\r\n                            <el-button type='warning' @click=\"addServiceLogBySelectedDrivers()\">運行を追加</el-button>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"row\" style=\"margin-top:2%;\">\r\n                        <div class='col-md-3'>\r\n                            <el-radio style=\"margin-left:5%;\" v-model=\"data.search.model.NarrowDestination\" label=\"decided\" @change=\"changeVisibilityDestination()\">行先決定済みのみ</el-radio>\r\n                        </div>\r\n                        <div class='col-md-3'>\r\n                            <el-radio style=\"margin-left:5%;\" v-model=\"data.search.model.NarrowDestination\" label=\"unDecided\" @change=\"changeVisibilityDestination()\">行先未決定のみ</el-radio>\r\n                        </div>\r\n                        <div class='col-md-3'>\r\n                            <el-radio style=\"margin-left:5%;\" v-model=\"data.search.model.NarrowDestination\" label=\"all\" @change=\"changeVisibilityDestination()\">すべて</el-radio>\r\n                        </div>\r\n\r\n                    </div>\r\n                    <div class=\"row\" style=\"margin-top:2%;\">\r\n                        <div class='col-md-9'>\r\n                        </div>\r\n                        <div class='col-md-3'>\r\n                            <el-button style='margin-top:13%;width:80%;' type='danger'@click=\"save()\">変更を保存</el-button>\r\n                        </div>\r\n                   \r\n                    </div>\r\n\r\n                </el-form>\r\n                <div class=\"row\" style=\"margin-top:4%;\">\r\n                    <div class=\"col-12\">\r\n                        <table class=\"table\">\r\n                            <thead>\r\n                                <tr>\r\n                                    <th>\r\n                                        社員名\r\n                                    </th>\r\n                                    <th>\r\n                                        行先\r\n                                    </th>\r\n                                    <th>\r\n                                        乗務前点呼時間\r\n                                    </th>\r\n                                    <th>\r\n                                        最終電話点呼時間\r\n                                    </th>\r\n                                    <th>\r\n                                        乗務後点呼時間\r\n                                    </th>\r\n                                    <th>\r\n                                        点呼内容を表示\r\n                                    </th>\r\n                                    <th>\r\n                                        運行を削除\r\n                                    </th>\r\n\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody v-for=\"meisai_data in data.meisai\" v-bind:key=\"meisai_data.index\" style=\"border-bottom:solid 0.5px #d3d3d3;\" v-if=\"judgeDisplayServiceLog(meisai_data.Visibility)\">\r\n                                <tr v-bind:style=\"getAlertColor(meisai_data)\">\r\n                                    <td>\r\n                                        {{meisai_data.ServiceLog.MemberName}}\r\n                                    </td>\r\n                                    <td style=\"width:20%;\">\r\n                                        <el-select name=\"name\" v-model=\"meisai_data.ServiceLog.DestinationID\" style=\"width:100%;\" @change=\"meisai_data.IsEdit = true\" :disabled=\"meisai_data.IsDelete\">\r\n                                            <el-option v-for=\"destination in data.destinations\" :value=\"destination.DestinationID\" :label=\"destination.DestinationName\"></el-option>\r\n                                        </el-select>\r\n                                    </td>\r\n                                    <td>\r\n                                        {{meisai_data.ServiceLog.BeforDrivingRollCallTime}}\r\n                                    </td>\r\n                                    <td>\r\n                                        {{meisai_data.ServiceLog.LastRollCallTime}}\r\n                                    </td>\r\n                                    <td>\r\n                                        {{meisai_data.ServiceLog.AfterDrivingRollCallTime}}\r\n                                    </td>\r\n                                    <td style=\"width:10%;\">\r\n                                        <el-button type='success' @click=\"moveRollCallInput(meisai_data)\" style=\"width:100%;\" :disabled=\"meisai_data.ServiceLog.ServiceLogID == -1\">点呼内容表示</el-button>\r\n                                    </td>\r\n                                    <td style=\"width:10%;\">\r\n                                        <el-button type='primary' @click=\"$set(meisai_data,'IsDelete',!meisai_data.IsDelete)\" style=\"width:100%;\">{{meisai_data.IsDelete ?\"復帰\" : \"削除\"}}</el-button>\r\n                                    </td>\r\n\r\n                                </tr>\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n\r\n\r\n\r\n            </div>\r\n        </el-card>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    // @ is an alias to /src\r\n    import Card from '@/components/Card/Card.vue'\r\n    import config from '@/config.js'\r\n    import ElIncrementSearch from '@/components/IncrementSearch.vue'\r\n    import arrayFunction from '@/js/array.js'\r\n    import url from '@/js/api_url.js'\r\n    import time from '@/js/status/time.js'\r\n\r\n\r\n    export default {\r\n        name: 'niukeSyukei',\r\n        components: {\r\n            Card, ElIncrementSearch\r\n        },\r\n        data: function () {\r\n            return {\r\n                data: {\r\n                    search: {\r\n                        model: {\r\n                            memberName: \"\",\r\n                            ServiceDate: \"\",\r\n                            IsLongDistance: \"\",\r\n                            IsAlert: false,\r\n                            NarrowDestination: \"all\",\r\n                            selectedDrivers: [],\r\n                        },\r\n                        validation: {\r\n                            memberName: [\r\n                                { required: true, message: '社員名が入力されていません', trigger: 'blur' },\r\n                            ],\r\n                        }\r\n                    },\r\n                    AlertColor: {\r\n                        0: \"\",\r\n                        1: \"\",\r\n                        2: \"\",\r\n                    },\r\n                    drivers: [],\r\n                    destinations: [],\r\n                    meisai: [],\r\n                    isSave: false,\r\n                },\r\n            }\r\n        },\r\n        methods: {\r\n\r\n            moveRollCallInput: function (meisai_data) {\r\n\r\n                if (window.confirm(\"変更が保存されませんがよろしいですか？\")) {\r\n\r\n                    this.$store.commit('changeMoveRollCallLogInput', { ServiceDate: meisai_data.ServiceLog.ServiceDate, MemberID: meisai_data.ServiceLog.DriverID });\r\n\r\n                    this.$router.push('/uedaunyu/rollCallLogInput');\r\n\r\n                }\r\n            },\r\n            getAlertColor: function (meisai_data) {\r\n\r\n                var alertKind = meisai_data.AlertKind;\r\n\r\n                if (meisai_data.IsDelete) {\r\n\r\n                    return \"background-color:#a9a9a9;\"\r\n\r\n                } else {\r\n                    if (alertKind == 0 || alertKind == 1 || alertKind == 2) {\r\n\r\n                        return \"background-color:\" + this.data.AlertColor[alertKind] + \";\";\r\n\r\n                    } else {\r\n\r\n                        return \"\";\r\n                    }\r\n                }\r\n\r\n               \r\n\r\n            },\r\n            getDriversIndex: function (DriverID) {\r\n\r\n                for (var i = 0; i < this.data.drivers.length; i++) {\r\n\r\n                    if (this.data.drivers[i].MemberID == DriverID) {\r\n                        return i;\r\n                    }\r\n                }\r\n\r\n\r\n            },\r\n            getDriver: function (DriverID) {\r\n\r\n                return this.data.drivers[this.getDriversIndex(DriverID)];\r\n            },\r\n            addServiceLogAllDrivers: function () {\r\n\r\n                for (var i = 0; i < this.data.drivers.length; i++) {\r\n\r\n                    var driver = this.data.drivers[i];\r\n\r\n                    console.log(driver);\r\n\r\n                    this.addServiceLog(driver.IsLongDistance, driver.DestinationID, -1, driver.MemberID,this.data.search.model.ServiceDate, driver.MemberName, \"\", \"\", \"\");\r\n\r\n                }\r\n\r\n            },\r\n            addServiceLogBySelectedDrivers: function () {\r\n\r\n                for (var i = 0; i < this.data.search.model.selectedDrivers.length; i++) {\r\n\r\n                    var driverID = this.data.search.model.selectedDrivers[i];\r\n\r\n                    for (var k = 0; k < this.data.drivers.length; k++) {\r\n\r\n                        var driver = this.data.drivers[k];\r\n\r\n                        if (driver.MemberID == driverID) {\r\n\r\n                            this.addServiceLog(driver.IsLongDistance, driver.DestinationID, -1, driver.MemberID, this.data.search.model.ServiceDate, driver.MemberName, \"\", \"\", \"\");\r\n                        }\r\n                        \r\n                    }\r\n\r\n                }\r\n\r\n\r\n            },\r\n            addServiceLog: function (IsLongDistance, DestinationID, ServiceLogID, DriverID, ServiceDate, MemberName, BeforDrivingRollCallTime, LastRollCallTime, AfterDrivingRollCallTime) {\r\n\r\n                this.data.meisai.push(this.createServiceLog(IsLongDistance, DestinationID, ServiceLogID, DriverID, ServiceDate, MemberName, BeforDrivingRollCallTime, LastRollCallTime, AfterDrivingRollCallTime));\r\n\r\n                console.log(this.data.meisai);\r\n                \r\n            },\r\n            createServiceLog: function (IsLongDistance, DestinationID, ServiceLogID, DriverID, ServiceDate, MemberName, BeforDrivingRollCallTime, LastRollCallTime, AfterDrivingRollCallTime) {\r\n\r\n\r\n                var Visibility = this.createVisibilityObject();\r\n\r\n                return {\r\n                    IsLongDistance: IsLongDistance,\r\n                    Visibility: Visibility,\r\n                    IsDelete: false,\r\n                    IsEdit: false,\r\n                    AlertKind: null,\r\n                    ServiceLog: {\r\n                        DestinationID: DestinationID,\r\n                        CompanyID: this.data.companyID,\r\n                        EditorID: this.data.editorID,\r\n                        ServiceLogID: ServiceLogID,\r\n                        DriverID: DriverID,\r\n                        ServiceDate: ServiceDate,\r\n                        MemberName: MemberName,\r\n                        BeforDrivingRollCallTime: BeforDrivingRollCallTime,\r\n                        LastRollCallTime: LastRollCallTime,\r\n                        AfterDrivingRollCallTime: AfterDrivingRollCallTime,\r\n\r\n                    }\r\n                }\r\n            },\r\n            createVisibilityObject: function () {\r\n\r\n                return {\r\n                    IsLongDistance: true,\r\n                    MemberName: true,\r\n                    IsAlert: true,\r\n                    IsDecidedDestination: true,\r\n                }\r\n            },\r\n            changeVisibilityIsLongDistance: function () {\r\n\r\n                var isLongDistance = this.data.search.model.IsLongDistance;\r\n                for (var i = 0; i < this.data.meisai.length; i++) {\r\n\r\n                    if (!this.data.meisai[i].IsDelete) {\r\n\r\n                        var visibility = true;\r\n\r\n                        if (isLongDistance != null) {\r\n\r\n                            if (this.data.meisai[i].IsLongDistance != isLongDistance) {\r\n                                visibility = false;\r\n                            }\r\n                        }\r\n\r\n                        this.data.meisai[i].Visibility.IsLongDistance = visibility;\r\n                    }\r\n\r\n                }\r\n\r\n            },\r\n            changeVisibilityIsAlert: function () {\r\n\r\n                var isAlert = this.data.search.model.IsAlert;\r\n\r\n                for (var i = 0; i < this.data.meisai.length; i++) {\r\n                    if (!this.data.meisai[i].IsDelete) {\r\n\r\n                        var visibility = true;\r\n\r\n                        if (isAlert) {\r\n\r\n                            if (this.data.meisai[i].AlertKind == null) {\r\n                                visibility = false;\r\n\r\n                            }\r\n                        }\r\n\r\n                        this.data.meisai[i].Visibility.IsAlert = visibility;\r\n                    }\r\n                }\r\n\r\n            },\r\n            changeVisibilityMemberName: function () {\r\n\r\n                var memberName = this.data.search.model.memberName;\r\n\r\n                for (var i = 0; i < this.data.meisai.length; i++) {\r\n                    if (!this.data.meisai[i].IsDelete) {\r\n\r\n                        var visibility = true;\r\n\r\n                        if (memberName != \"\") {\r\n\r\n                            if (this.data.meisai[i].ServiceLog.MemberName.indexOf(memberName) == -1) {\r\n\r\n                                visibility = false;\r\n\r\n                            }\r\n                        }\r\n\r\n                        this.data.meisai[i].Visibility.MemberName = visibility;\r\n                    }\r\n                }\r\n\r\n            },\r\n            changeVisibilityDestination: function () {\r\n\r\n                var destination = this.data.search.model.NarrowDestination;\r\n\r\n                for (var i = 0; i < this.data.meisai.length; i++) {\r\n                    if (!this.data.meisai[i].IsDelete) {\r\n\r\n                        var visibility = true;\r\n\r\n                        if (destination != \"all\") {\r\n\r\n                            var destinationID = this.data.meisai[i].ServiceLog.DestinationID;\r\n\r\n                            if (destination == \"unDecided\") {\r\n                                if (destinationID != null) {\r\n                                    visibility = false;\r\n                                }\r\n                            } else if (destination == \"decided\") {\r\n                                if (destinationID == null) {\r\n                                    visibility = false;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        this.data.meisai[i].Visibility.IsDecidedDestination = visibility;\r\n                    }\r\n                }\r\n\r\n            },\r\n\r\n\r\n            judgeDisplayServiceLog: function (visibility) {\r\n\r\n                var result = true;\r\n\r\n                for (var i in visibility) {\r\n\r\n                    if (!visibility[i]) {\r\n                        result = false;\r\n                    }\r\n\r\n                }\r\n                return result\r\n            },\r\n            serviceLogSearch: function () {\r\n\r\n                axios.get(url.ApiUrl().GetRollCallStatus([{ key: \"CompanyID\", value: this.data.companyID }, { key: \"ServiceDate\", value: this.data.search.model.ServiceDate }]))\r\n                    .then(response => {\r\n\r\n                        console.log(response.data);\r\n                        this.$set(this.data, \"meisai\", response.data);\r\n\r\n                        for (var i in this.data.meisai) {\r\n\r\n                            this.$set(this.data.meisai[i], \"Visibility\", this.createVisibilityObject());\r\n\r\n                            this.$set(this.data.meisai[i].ServiceLog, \"MemberName\", this.getDriver(this.data.meisai[i].ServiceLog.DriverID).MemberName);\r\n\r\n                        }\r\n\r\n                        console.log(this.data.meisai);\r\n\r\n              \r\n                    })\r\n                    .catch(response => {\r\n                    })\r\n\r\n\r\n            },\r\n            save: function () {\r\n\r\n                this.data.isSave = true;\r\n                axios.put(url.ApiUrl().RollCallStatusSave(), this.data.meisai)\r\n                    .then(response => {\r\n\r\n                        console.log(response.data);\r\n                        if (response.data) {\r\n\r\n                            this.$message({\r\n                                message: '登録に成功しました',\r\n                                type: 'success'\r\n                            });\r\n\r\n                            this.serviceLogSearch();\r\n\r\n                        } else {\r\n\r\n                            this.$message({\r\n                                message: '登録に失敗しました',\r\n                                type: 'error'\r\n                            });\r\n\r\n                        }\r\n\r\n\r\n                        this.data.isSave = false;\r\n\r\n                    })\r\n                    .catch(response => {\r\n\r\n                        this.$message({\r\n                            message: '通信に失敗しました',\r\n                            type: 'error'\r\n                        });\r\n\r\n                        this.data.isSave = false;\r\n\r\n                    })\r\n\r\n            },\r\n            sendEmail: function () {\r\n\r\n                this.data.isSave = true;\r\n                axios.post(url.ApiUrl().RollCallStatusSendEmail(), this.data.meisai)\r\n                    .then(response => {\r\n\r\n                        console.log(response.data);\r\n                        if (response.data) {\r\n\r\n                            this.$message({\r\n                                message: '登録及び違反者へのメール送信に成功しました',\r\n                                type: 'success'\r\n                            });\r\n\r\n                            this.serviceLogSearch();\r\n\r\n                        } else {\r\n\r\n                            this.$message({\r\n                                message: '登録及び違反者へのメール送信に失敗しました',\r\n                                type: 'error'\r\n                            });\r\n\r\n                        }\r\n\r\n\r\n                        this.data.isSave = false;\r\n\r\n                    })\r\n                    .catch(response => {\r\n\r\n                        this.$message({\r\n                            message: '通信に失敗しました',\r\n                            type: 'error'\r\n                        });\r\n\r\n                        this.data.isSave = false;\r\n\r\n                    })\r\n\r\n            }\r\n\r\n\r\n        },\r\n        created: function () {\r\n\r\n\r\n            this.data.companyID = this.$store.state.login.companyID;\r\n            this.data.editorID = this.$store.state.login.userID;\r\n\r\n            this.data.search.model.ServiceDate = time.nowJapanDateInput();\r\n\r\n            axios.get(url.ApiUrl().GetRollCallStatusMasterData([{ key: \"CompanyID\", value: this.data.companyID }]))\r\n                .then(response => {\r\n\r\n                    console.log(response.data.Drivers);\r\n\r\n                    this.$set(this.data, \"drivers\", response.data.Drivers);\r\n                    this.$set(this.data, \"destinations\", response.data.Destinations);\r\n\r\n                    this.$set(this.data, \"AlertColor\", response.data.AlertColor);\r\n\r\n\r\n                    this.serviceLogSearch();\r\n\r\n                })\r\n                .catch(response => console.log(response))\r\n\r\n\r\n        },\r\n        mounted: function () {\r\n\r\n        },\r\n        watch: {\r\n\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n\r\n    .search {\r\n        background-color: blue;\r\n        color: white;\r\n    }\r\n</style>"]}]}