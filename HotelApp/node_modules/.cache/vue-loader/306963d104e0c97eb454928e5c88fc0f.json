{"remainingRequest":"C:\\Users\\takum\\Documents\\hokuriku_tosbac\\HotelApp\\project\\HotelApp\\HotelApp\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\takum\\Documents\\hokuriku_tosbac\\HotelApp\\project\\HotelApp\\HotelApp\\src\\pages\\RollCallLogInput.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\takum\\Documents\\hokuriku_tosbac\\HotelApp\\project\\HotelApp\\HotelApp\\src\\pages\\RollCallLogInput.vue","mtime":1607327149760},{"path":"C:\\Users\\takum\\Documents\\hokuriku_tosbac\\HotelApp\\project\\HotelApp\\HotelApp\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\takum\\Documents\\hokuriku_tosbac\\HotelApp\\project\\HotelApp\\HotelApp\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\takum\\Documents\\hokuriku_tosbac\\HotelApp\\project\\HotelApp\\HotelApp\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// @ is an alias to /src\nimport Card from '@/components/Card/Card.vue'\nimport config from '@/config.js'\nimport ElIncrementSearch from '@/components/IncrementSearch.vue'\nimport arrayFunction from '@/js/array.js'\nimport url from '@/js/api_url.js'\nimport time from '@/js/status/time.js'\n\nexport default {\n    name: 'niukeSyukei',\n    components: {\n        Card, ElIncrementSearch\n    },\n    data: function () {\n        return {\n            data: {\n                companyID: \"\",\n                search: {\n                    model: {\n                        MemberID: \"\",\n                        ServiceDate: \"2020-11-18\",\n                    },\n                    validation: {\n                        MemberID: [\n                            { required: true, message: '社員名が入力されていません', trigger: 'blur' },\n                        ],\n                        ServiceDate: [\n                            { required: true, message: '運行日が入力されていません', trigger: 'blur' },\n                        ],\n                    }\n                },\n                isSearch: false,\n                isSave: false,\n                log: {\n                    service: [],\n                    driverID: \"\",\n                    driverName:\"\",\n                    serviceDate: \"\",\n                    deletes: {\n                        ServiceLogs: [],\n                        RollCallLogs: [],\n                    },\n                },\n                meisai: [],\n                updateButton: \"\",\n                drivers: [],\n                rollcallers: [],\n                destinations: [],\n                vehicles: [],\n                rollcallmethods: [],\n                diseases: [],\n                instructions: [],\n\n            },\n        }\n    },\n    methods: {\n        getDiseasesIndex: function (DiseaseID) {\n\n            for (var i = 0; i < this.data.diseases.length; i++) {\n\n                if (this.data.diseases[i].DiseaseID == DiseaseID) {\n                    return i;\n                }\n            }\n        },\n        getDriversIndex: function (DriverID) {\n\n            for (var i = 0; i < this.data.drivers.length; i++) {\n\n                if (this.data.drivers[i].MemberID == DriverID) {\n                    return i;\n                }\n            }\n\n\n        },\n        getDriver: function (DriverID) {\n\n            return this.data.drivers[this.getDriversIndex(DriverID)];\n        },\n        changeRollCallRogTurn: function (seviceIndex, index, kind) {\n\n            var rollCallLog = this.data.log.service[seviceIndex].RollCallLog;\n\n            if (kind == \"up\") {\n\n                rollCallLog.splice(index - 1, 2, rollCallLog[index], rollCallLog[index - 1]);\n\n            } else if (kind == \"down\") {\n\n                rollCallLog.splice(index, 2, rollCallLog[index + 1], rollCallLog[index]);\n\n            }\n\n        },\n        changeServiceRogTurn: function (index, kind) {\n\n            var serviceLog = this.data.log.service;\n\n            if (kind == \"up\") {\n\n                serviceLog.splice(index - 1, 2, serviceLog[index], serviceLog[index - 1]);\n\n            } else if (kind == \"down\") {\n\n                serviceLog.splice(index, 2, serviceLog[index + 1], serviceLog[index]);\n\n            }\n\n        },\n        addServiceMeisai: function () {\n\n            var driver = this.getDriver(this.data.log.driverID);\n            var vehicleID = driver.VehicleID;\n            var destinationID = driver.DestinationID;\n\n\n            this.data.log.service.push({\n                ServiceLog: {\n                    DestinationID: destinationID,\n                    VehicleID: vehicleID,\n                    CompanyID: this.data.companyID,\n                    EditorID: this.data.editorID,\n                    ServiceLogID: -1,\n                    DriverID: this.data.log.driverID,\n                    ServiceDate: this.data.log.serviceDate\n                }, RollCallLog: [{\n                    RollCallLogID: -1,\n                    CompanyID: this.data.companyID,\n                    EditorID: this.data.editorID\n                }]\n            });\n\n\n        },\n        remobeServiceMeisai: function (ServiceLogIndex) {\n\n            if (window.confirm(\"削除しますか？\")) {\n\n                if (this.data.log.service[ServiceLogIndex].ServiceLog.ServiceLogID != -1) {\n\n\n                    this.data.log.deletes.ServiceLogs.push(this.data.log.service[ServiceLogIndex].ServiceLog);\n\n                    for (var i in this.data.log.service[ServiceLogIndex].RollCallLog) {\n\n                        this.data.log.deletes.RollCallLogs.push(this.data.log.service[ServiceLogIndex].RollCallLog[i]);\n\n                    }\n                } \n\n                this.data.log.service.splice(ServiceLogIndex, 1);\n\n            }\n\n        },\n        addRollCallMeisai: function (ServiceLogIndex) {\n\n            this.data.log.service[ServiceLogIndex].RollCallLog.push({\n                CompanyID: this.data.companyID,\n                EditorID: this.data.editorID,\n                RollCallLogID: -1\n            });\n\n        },\n        removeRollCallMeisai: function (ServiceLogIndex, RollCallLogIndex) {\n\n            if (window.confirm(\"削除しますか？\")) {\n\n                if (this.data.log.service[ServiceLogIndex].RollCallLog[RollCallLogIndex].RollCallLogID != -1) {\n\n                    this.data.log.deletes.RollCallLogs.push(this.data.log.service[ServiceLogIndex].RollCallLog[RollCallLogIndex]);\n                }\n                console.log(this.data.log.deletes);\n                this.data.log.service[ServiceLogIndex].RollCallLog.splice(RollCallLogIndex, 1);\n\n            }\n\n        },\n        search: function (initFlag) {\n\n            this.$refs['searchForm'].validate((valid) => {\n\n                if (valid) {\n\n                    if (this.data.isSearch) {\n\n                        if (!initFlag) {\n                            if (!window.confirm(\"点呼記録が保存されませんがよろしいですか？\")) {\n                                return false;\n                            }\n                        } \n                        \n                    }\n\n                    this.init();\n\n                    this.getRollCallLogsInput(initFlag);\n\n                }\n            })\n\n        },\n        init: function () {\n\n            this.$set(this.data.log, \"service\", []);\n\n        },\n        initInput: function () {\n\n            if (!window.confirm(\"点呼記録が保存されませんがよろしいですか？\")) {\n                return false;\n            }\n            this.init();\n            this.data.isSearch = false;\n\n        },\n        getRollCallLogsInput: function (initFlag) {\n\n            axios.get(url.ApiUrl().GetRollCallLogInputs([{ key: \"MemberID\", value: this.data.search.model.MemberID }, { key: \"ServiceDate\", value: this.data.search.model.ServiceDate }]))\n                .then(response => {\n\n                    this.data.log.driverID = this.data.search.model.MemberID;\n                    this.data.log.driverName = this.getDriver(this.data.search.model.MemberID).MemberName;\n                    this.data.log.serviceDate = this.data.search.model.ServiceDate;\n                    console.log(response.data);\n                    if (response.data.length == 0) {\n\n                        this.addServiceMeisai();\n\n                    } else {\n\n                        this.$set(this.data.log, \"service\", response.data);\n\n\n                    }\n\n                    this.data.isSearch = true;\n                    console.log(initFlag);\n                    if (initFlag) {\n                        this.$store.commit('changeMoveRollCallLogInput', { ServiceDate: \"\", MemberID: \"\" });\n\n                    }\n\n                })\n                .catch(response => {\n                    this.data.isSearch = false;\n                })\n\n\n\n        },\n        save: function () {\n\n\n            this.$refs['logForm'].validate((valid) => {\n\n                if (valid) {\n\n\n                    for (var i in this.data.log.service) {\n\n                        var beforDrivingRollCallLogCount = 0;\n                        var afterDrivingRollCallLogCount = 0;\n\n                        \n\n                        for (var k in this.data.log.service[i].RollCallLog) {\n\n                            if (this.data.log.service[i].RollCallLog[k].RollCallKind == 0) {\n\n                                beforDrivingRollCallLogCount++;\n\n                            } else if (this.data.log.service[i].RollCallLog[k].RollCallKind == 1) {\n\n                                afterDrivingRollCallLogCount++;\n                            }\n\n\n                        }\n\n                        console.log(beforDrivingRollCallLogCount, afterDrivingRollCallLogCount);\n\n                        if (beforDrivingRollCallLogCount >= 2 || afterDrivingRollCallLogCount >= 2) {\n\n                            alert(\"乗務前点呼及び乗務後点呼は2つ以上登録できません\");\n\n                            return false;\n                        }\n\n                    }\n\n\n\n                    this.data.isSave = true;\n                    axios.post(url.ApiUrl().RollCallLogInputsSave(), this.data.log.service)\n                        .then(response => {\n\n                            if (response.data) {\n\n\n                                axios.put(url.ApiUrl().RollCallLogInputsDelete(), this.data.log.deletes)\n                                    .then(response => {\n\n                                        if (response.data) {\n\n                                            this.$message({\n                                                message: '登録に成功しました',\n                                                type: 'success'\n                                            });\n\n                                        } else {\n\n                                            this.$message({\n                                                message: '登録に失敗しました',\n                                                type: 'error'\n                                            });\n\n                                        }\n\n\n                                        this.data.isSave = false;\n\n                                    })\n                                    .catch(response => {\n                                        this.$message({\n                                            message: '通信に失敗しました',\n                                            type: 'error'\n                                        });\n\n                                        this.data.isSave = false;\n\n                                    });\n\n\n   \n                            } else {\n\n                                this.$message({\n                                    message: '登録に失敗しました',\n                                    type: 'error'\n                                });\n\n                            }\n\n\n                        })\n                        .catch(response => {\n                            this.$message({\n                                message: '通信に失敗しました',\n                                type: 'error'\n                            });\n\n\n                            this.data.isSave = false;\n\n                        });\n\n                }\n            })\n\n        }\n\n    },\n    created: function () {\n\n        this.data.companyID = this.$store.state.login.companyID;\n        this.data.editorID = this.$store.state.login.userID;\n\n        this.data.search.model.ServiceDate = time.nowJapanDateInput();\n\n        axios.get(url.ApiUrl().GetRollCallLogInputMasterData([{ key: \"CompanyID\", value: this.data.companyID }]))\n            .then(response => {\n\n                this.$set(this.data, \"drivers\", response.data.Drivers);\n                this.$set(this.data, \"rollcallers\", response.data.RollCallers);\n                this.$set(this.data, \"destinations\", response.data.Destinations);\n                this.$set(this.data, \"vehicles\", response.data.Vehicles);\n                this.$set(this.data, \"rollcallmethods\", response.data.RollCallMethods);\n                this.$set(this.data, \"diseases\", response.data.Diseases);\n                this.$set(this.data, \"instructions\", response.data.Instructions);\n\n                console.log(this.data.drivers);\n\n                if (this.$store.state.moveRollCallLogInput.ServiceDate != \"\") {\n\n                    this.data.search.model.ServiceDate = this.$store.state.moveRollCallLogInput.ServiceDate;\n                    this.data.search.model.MemberID = this.$store.state.moveRollCallLogInput.MemberID;\n\n                    this.search(true);\n\n\n                }\n\n            })\n            .catch(response => console.log(response))\n\n\n\n\n    },\n    mounted: function () {\n\n\n    },\n    watch: {\n    }\n}\n",{"version":3,"sources":["RollCallLogInput.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8RA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;;AAEA;;;AAGA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;;AAGA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;;;AAIA;AACA;;;AAGA;;AAEA;;;AAGA;;AAEA;AACA;;;;AAIA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;;AAGA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;;;AAIA;AACA;AACA;;AAEA;;;AAGA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;;AAIA;;AAEA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;;AAGA;;AAEA;AACA;;;;;AAKA;AACA;;;AAGA;AACA;AACA;AACA","file":"RollCallLogInput.vue","sourceRoot":"src/pages","sourcesContent":["<template>\r\n    <div>\r\n        <el-card>\r\n            <div slot='header'>\r\n                <span>点呼記録入力</span>\r\n            </div>\r\n            <div slot='default'>\r\n                <el-form :model=\"data.search.model\" :rules=\"data.search.validation\" ref=\"searchForm\" label-width=\"120px\">\r\n                    <div class=\"row\">\r\n                        <div class='col-md-3'>\r\n                            <label for='運行日' class='col-form-label px-1' style='width:100%;'>運行日：</label>\r\n                            <el-form-item label-width=\"0\" prop=\"ServiceDate\">\r\n                                <el-input type=\"date\"\r\n                                          style='width:100%;'\r\n                                          v-model=\"data.search.model.ServiceDate\"></el-input>\r\n\r\n                            </el-form-item>\r\n                        </div>\r\n                        <div class='col-md-9' style=\"text-align:right;\">\r\n                            <label class='col-form-label px-1' style='width:100%;'></label>\r\n                            <el-button style='width: 40%;' type='warning' @click=\"$router.push('/RollCallLogInput')\">戻る</el-button>\r\n                        </div>\r\n\r\n                    </div>\r\n                    <div class=\"row\">\r\n                        <div class='col-md-3'>\r\n                            <label for='運転手選択' class='col-form-label px-1' style='width:100%;'>運転手選択：</label>\r\n                            <el-form-item label-width=\"0\" prop=\"MemberID\">\r\n                                <el-select name=\"name\" v-model=\"data.search.model.MemberID\">\r\n                                    <el-option v-for=\"driver in data.drivers\" :value=\"driver.MemberID\" :label=\"driver.MemberName\"></el-option>\r\n                                </el-select>\r\n                            </el-form-item>\r\n                        </div>\r\n                        <div class='col-md-3' style=\"\">\r\n                            <label class='col-form-label px-1' style='width:100%;'>検索：</label>\r\n                            <el-button style='width:40%;' type='success' @click=\"search(false)\" icon=\"el-icon-search\" :disabled=\"data.isSave\">検索</el-button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class=\"row\" style=\"margin-top:4%;\">\r\n                        <div class='col-md-3'>\r\n                            <label for='選択中の運航日' class='col-form-label px-1' style='width:100%;'>選択中の運航日：</label>\r\n                            <el-input v-model=\"data.log.serviceDate\" readonly></el-input>\r\n\r\n                        </div>\r\n                        <div class='col-md-3' style=\"\">\r\n                            <label for='選択中の運転手' class='col-form-label px-1' style='width:100%;'>選択中の運転手：</label>\r\n                            <el-input v-model=\"data.log.driverName\" readonly></el-input>\r\n                        </div>\r\n                        <div class='col-md-3' style=\"\">\r\n                        </div>\r\n                        <div class='col-md-3' style=\"\">\r\n                            <label for='最初に戻る' class='col-form-label px-1' style='width:100%;'>最初に戻る：</label>\r\n                            <el-button style='width:40%;' type='info' @click=\"initInput()\"　:disabled=\"data.isSave\">最初に戻る</el-button>\r\n                        </div>\r\n\r\n                    </div>\r\n\r\n\r\n                </el-form>\r\n                <el-form :model=\"data.log\" ref=\"logForm\" label-width=\"120px\">\r\n\r\n                    <div class=\"row\" style=\"margin-top:4%;\">\r\n                        <div class='col-12' style=\"text-align:right; margin-top:2%;\">\r\n                            <el-button style='width:30%;' type='danger' @click=\"save()\" v-if=\"data.isSearch\":disabled=\"data.isSave\">保存</el-button>\r\n                        </div>\r\n                        <div class=\"col-12\" v-for=\"(ServiceLog ,ServiceLogIndex) in data.log.service\" style=\"margin-top:2%;\">\r\n                            <el-card>\r\n                                <div class=\"row\">\r\n                                    <div class=\"col-2\">\r\n                                        <label for='行先選択' class='col-form-label px-1' style='width:100%;'>行先選択</label>\r\n                                        <el-select name=\"name\" v-model=\"ServiceLog.ServiceLog.DestinationID\":disabled=\"data.isSave\">\r\n                                            <el-option v-for=\"destination in data.destinations\" :value=\"destination.DestinationID\" :label=\"destination.DestinationName\"></el-option>\r\n                                        </el-select>\r\n                                    </div>\r\n                                    <div class=\"col-2\">\r\n                                        <label for='車両選択' class='col-form-label px-1' style='width:100%;'>車両選択</label>\r\n                                        <el-select name=\"name\" v-model=\"ServiceLog.ServiceLog.VehicleID\":disabled=\"data.isSave\">\r\n                                            <el-option v-for=\"vehicle in data.vehicles\" :value=\"vehicle.VehicleID\" :label=\"vehicle.VehicleName\"></el-option>\r\n                                        </el-select>\r\n                                    </div>\r\n                                    <div class=\"col-5\"></div>\r\n                                    <div class=\"col-3\">\r\n                                        <label for='運行順番の入れ替え' class='col-form-label px-1' style='width:100%;'>運行順番の入れ替え</label>\r\n                                        <el-button type='info'\r\n                                                   style=''\r\n                                                   :disabled=\"ServiceLogIndex == 0 || data.isSave\"\r\n                                                   @click=\"changeServiceRogTurn(ServiceLogIndex,'up')\">▲</el-button>\r\n                                        <el-button type='info'\r\n                                                   style=''\r\n                                                   :disabled=\"ServiceLogIndex == data.log.service.length - 1 || data.isSave\"\r\n                                                   @click=\"changeServiceRogTurn(ServiceLogIndex,'down')\">▼</el-button>\r\n                                    </div>\r\n                                    <div class=\"col-12\" v-for=\"(RollCallLog ,RollCallLogIndex) in ServiceLog.RollCallLog\">\r\n                                        <el-card style=\"margin-top:2%;width:90%; float:left;\">\r\n                                            <table class=\"table\">\r\n                                                <thead>\r\n                                                    <tr>\r\n                                                        <th>\r\n                                                            点呼時間\r\n                                                        </th>\r\n                                                        <th>\r\n                                                            点呼方法\r\n                                                        </th>\r\n                                                        <th>\r\n                                                            アルコール検知器の有無\r\n                                                        </th>\r\n                                                        <th>\r\n                                                            酒気帯びの有無\r\n                                                        </th>\r\n                                                    </tr>\r\n                                                </thead>\r\n                                                <tr style=\"border-bottom:solid 0.5px #d3d3d3;\">\r\n                                                    <td>\r\n                                                        <el-form-item label-width=\"0\"\r\n                                                                      :prop=\"'service[' + ServiceLogIndex + '].RollCallLog[' + RollCallLogIndex + '].RollCallTime'\"\r\n                                                                      :rules=\"{\r\n                                                              required: true, message: '点呼時間が入力されていません', trigger: 'blur'\r\n                                                              }\">\r\n\r\n                                                            <el-input type='datetime-local'\r\n                                                                      style='width:100%;'\r\n                                                                      v-model=\"RollCallLog.RollCallTime\"\r\n                                                                      :disabled=\"data.isSave\"></el-input>\r\n                                                        </el-form-item>\r\n                                                    </td>\r\n                                                    <td>\r\n                                                        <el-select name=\"name\" v-model=\"RollCallLog.RollCallMethodID\" style=\"width:100%;\":disabled=\"data.isSave\">\r\n                                                            <el-option v-for=\"rollcallmethod in data.rollcallmethods\" :value=\"rollcallmethod.RollCallMethodID\" :label=\"rollcallmethod.RollCallMethodName\"></el-option>\r\n                                                        </el-select>\r\n                                                    </td>\r\n                                                    <td>\r\n                                                        <el-select name=\"name\" v-model=\"RollCallLog.IsUseAlcoholDetector\" style=\"width:100%;\":disabled=\"data.isSave\">\r\n                                                            <el-option :value=\"true\" label=\"有\"></el-option>\r\n                                                            <el-option :value=\"false\" label=\"無\"></el-option>\r\n                                                        </el-select>\r\n                                                    </td>\r\n                                                    <td>\r\n                                                        <el-select name=\"name\" v-model=\"RollCallLog.IsDrinking\" style=\"width:100%;\":disabled=\"data.isSave\">\r\n                                                            <el-option :value=\"false\" label=\"無\"></el-option>\r\n                                                            <el-option :value=\"true\" label=\"有\"></el-option>\r\n                                                        </el-select>\r\n                                                    </td>\r\n                                                </tr>\r\n                                                <thead>\r\n                                                    <tr>\r\n                                                        <th>\r\n                                                            疾病・疲労等の有無\r\n                                                        </th>\r\n                                                        <th>\r\n                                                            詳細\r\n                                                        </th>\r\n                                                        <th colspan=\"2\">\r\n                                                            備考\r\n                                                        </th>\r\n                                                    </tr>\r\n                                                </thead>\r\n                                                <tr style=\"border-bottom:solid 0.5px #d3d3d3;\">\r\n                                                    <td>\r\n                                                        <el-select name=\"name\" v-model=\"RollCallLog.IsDisease\" style=\"width:100%;\":disabled=\"data.isSave\">\r\n                                                            <el-option :value=\"true\" label=\"有\"></el-option>\r\n                                                            <el-option :value=\"false\" label=\"無\"></el-option>\r\n                                                        </el-select>\r\n                                                    </td>\r\n                                                    <td>\r\n                                                        <el-select name=\"name\" v-model=\"RollCallLog.DiseasesID\" style=\"width:100%;\" :disabled=\"!RollCallLog.IsDisease || data.isSave\">\r\n                                                            <el-option v-for=\"disease in data.diseases\" :value=\"disease.DiseaseID\" :label=\"disease.DiseaseName\"></el-option>\r\n                                                        </el-select>\r\n                                                    </td>\r\n                                                    <td colspan=\"2\">\r\n                                                        <el-input type='text'\r\n                                                                  style='width:100%;'\r\n                                                                  :disabled=\"data.diseases[getDiseasesIndex(RollCallLog.DiseasesID)] != undefined ? !data.diseases[getDiseasesIndex(RollCallLog.DiseasesID)].NoteFlag:true || data.isSave\"\r\n                                                                  v-model=\"RollCallLog.NoteOfDiseases\"\r\n                                                                  ></el-input>\r\n                                                    </td>\r\n                                                </tr>\r\n                                                <thead>\r\n                                                    <tr>\r\n                                                        <th>\r\n                                                            日常点検の有無\r\n                                                        </th>\r\n                                                        <th>\r\n                                                            点呼執行者\r\n                                                        </th>\r\n                                                        <th>\r\n                                                            指示事項\r\n                                                        </th>\r\n                                                        <th>\r\n                                                            点呼種類\r\n                                                        </th>\r\n                                                    </tr>\r\n                                                </thead>\r\n                                                <tr style=\"border-bottom:solid 0.5px #d3d3d3;\">\r\n                                                    <td>\r\n                                                        <el-select name=\"name\" v-model=\"RollCallLog.IsPerformedDailyCheck\" style=\"width:100%;\":disabled=\"data.isSave\">\r\n                                                            <el-option :value=\"true\" label=\"有\"></el-option>\r\n                                                            <el-option :value=\"false\" label=\"無\"></el-option>\r\n                                                        </el-select>\r\n                                                    </td>\r\n                                                    <td>\r\n                                                        <el-select name=\"name\" v-model=\"RollCallLog.RollCallerID\" style=\"width:100%;\":disabled=\"data.isSave\">\r\n                                                            <el-option v-for=\"rollcaller in data.rollcallers\" :value=\"rollcaller.MemberID\" :label=\"rollcaller.MemberName\"></el-option>\r\n                                                        </el-select>\r\n                                                    </td>\r\n                                                    <td>\r\n                                                        <el-select name=\"name\" v-model=\"RollCallLog.InstructionID\" style=\"width:100%;\":disabled=\"data.isSave\">\r\n                                                            <el-option v-for=\"instruction in data.instructions\" :value=\"instruction.InstructionID\" :label=\"instruction.InstructionName\"></el-option>\r\n                                                        </el-select>\r\n                                                    </td>\r\n                                                    <td>\r\n                                                        <el-form-item label-width=\"0\"\r\n                                                                      :prop=\"'service[' + ServiceLogIndex + '].RollCallLog[' + RollCallLogIndex + '].RollCallKind'\"\r\n                                                                      :rules=\"{\r\n                                                              required: true, message: '点呼の種類が選択されていません', trigger: 'blur'\r\n                                                              }\">\r\n\r\n                                                            <el-select name=\"name\" v-model=\"RollCallLog.RollCallKind\" style=\"width:100%;\" :disabled=\"data.isSave\">\r\n                                                                <el-option :value=\"0\" label=\"乗務前点呼\"></el-option>\r\n                                                                <el-option :value=\"1\" label=\"乗務後点呼\"></el-option>\r\n                                                                <el-option :value=\"2\" label=\"途中点呼\"></el-option>\r\n                                                            </el-select>\r\n                                                        </el-form-item>\r\n                                                    </td>\r\n                                                </tr>\r\n\r\n                                            </table>\r\n                                            <div class=\"col-12\" style=\"text-align:right;margin-top:2%;\">\r\n                                                <el-button type='info'\r\n                                                           style='width:20%;display:inline;'\r\n                                                           @click=\"removeRollCallMeisai(ServiceLogIndex,RollCallLogIndex)\"\r\n                                                           :disabled=\"data.isSave\">点呼を削除</el-button>\r\n                                            </div>\r\n                                        </el-card>\r\n                                        <div style=\"width:10%;float:left;text-align:center;margin-top:15%;\">\r\n                                            <div>\r\n                                                <el-button type='info'\r\n                                                           style=''\r\n                                                           :disabled=\"RollCallLogIndex == 0 || data.isSave\"\r\n                                                           @click=\"changeRollCallRogTurn(ServiceLogIndex,RollCallLogIndex,'up')\">▲</el-button>\r\n                                            </div>\r\n                                            <div style=\"margin-top:5%;\">\r\n                                                <el-button type='info'\r\n                                                           style=''\r\n                                                           :disabled=\"RollCallLogIndex == ServiceLog.RollCallLog.length - 1 || data.isSave\"\r\n                                                           @click=\"changeRollCallRogTurn(ServiceLogIndex,RollCallLogIndex,'down')\">▼</el-button>\r\n\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                    </div>\r\n                                    <div class=\"col-12\" style=\"text-align:center;margin-top:2%;\">\r\n                                        <el-button type='warning'\r\n                                                   style='width:40%;display:inline;'\r\n                                                   @click=\"addRollCallMeisai(ServiceLogIndex)\"\r\n                                                   :disabled=\"data.isSave\">点呼を追加</el-button>\r\n                                    </div>\r\n                                    <div class=\"col-12\" style=\"text-align:right;margin-top:2%;\">\r\n                                        <el-button type='info'\r\n                                                   style='width:20%;display:inline;'\r\n                                                   @click=\"remobeServiceMeisai(ServiceLogIndex)\"\r\n                                                   :disabled=\"data.isSave\">運行を削除</el-button>\r\n                                    </div>\r\n                                </div>\r\n                            </el-card>\r\n                        </div>\r\n                        <div class=\"col-12\" style=\"text-align:center;margin-top:2%;\">\r\n                            <el-button type='primary'\r\n                                       style='width:40%;display:inline;'\r\n                                       v-if=\"data.isSearch\"\r\n                                       @click=\"addServiceMeisai()\"\r\n                                       :disabled=\"data.isSave\">運行を追加</el-button>\r\n                        </div>\r\n                        <div class='col-12' style=\"text-align:right; margin-top:2%;\">\r\n                            <el-button style='width:30%;' type='danger' @click=\"save()\" v-if=\"data.isSearch\" :disabled=\"data.isSave\">保存</el-button>\r\n                        </div>\r\n                    </div>\r\n\r\n                </el-form>\r\n\r\n            </div>\r\n        </el-card>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    // @ is an alias to /src\r\n    import Card from '@/components/Card/Card.vue'\r\n    import config from '@/config.js'\r\n    import ElIncrementSearch from '@/components/IncrementSearch.vue'\r\n    import arrayFunction from '@/js/array.js'\r\n    import url from '@/js/api_url.js'\r\n    import time from '@/js/status/time.js'\r\n\r\n    export default {\r\n        name: 'niukeSyukei',\r\n        components: {\r\n            Card, ElIncrementSearch\r\n        },\r\n        data: function () {\r\n            return {\r\n                data: {\r\n                    companyID: \"\",\r\n                    search: {\r\n                        model: {\r\n                            MemberID: \"\",\r\n                            ServiceDate: \"2020-11-18\",\r\n                        },\r\n                        validation: {\r\n                            MemberID: [\r\n                                { required: true, message: '社員名が入力されていません', trigger: 'blur' },\r\n                            ],\r\n                            ServiceDate: [\r\n                                { required: true, message: '運行日が入力されていません', trigger: 'blur' },\r\n                            ],\r\n                        }\r\n                    },\r\n                    isSearch: false,\r\n                    isSave: false,\r\n                    log: {\r\n                        service: [],\r\n                        driverID: \"\",\r\n                        driverName:\"\",\r\n                        serviceDate: \"\",\r\n                        deletes: {\r\n                            ServiceLogs: [],\r\n                            RollCallLogs: [],\r\n                        },\r\n                    },\r\n                    meisai: [],\r\n                    updateButton: \"\",\r\n                    drivers: [],\r\n                    rollcallers: [],\r\n                    destinations: [],\r\n                    vehicles: [],\r\n                    rollcallmethods: [],\r\n                    diseases: [],\r\n                    instructions: [],\r\n\r\n                },\r\n            }\r\n        },\r\n        methods: {\r\n            getDiseasesIndex: function (DiseaseID) {\r\n\r\n                for (var i = 0; i < this.data.diseases.length; i++) {\r\n\r\n                    if (this.data.diseases[i].DiseaseID == DiseaseID) {\r\n                        return i;\r\n                    }\r\n                }\r\n            },\r\n            getDriversIndex: function (DriverID) {\r\n\r\n                for (var i = 0; i < this.data.drivers.length; i++) {\r\n\r\n                    if (this.data.drivers[i].MemberID == DriverID) {\r\n                        return i;\r\n                    }\r\n                }\r\n\r\n\r\n            },\r\n            getDriver: function (DriverID) {\r\n\r\n                return this.data.drivers[this.getDriversIndex(DriverID)];\r\n            },\r\n            changeRollCallRogTurn: function (seviceIndex, index, kind) {\r\n\r\n                var rollCallLog = this.data.log.service[seviceIndex].RollCallLog;\r\n\r\n                if (kind == \"up\") {\r\n\r\n                    rollCallLog.splice(index - 1, 2, rollCallLog[index], rollCallLog[index - 1]);\r\n\r\n                } else if (kind == \"down\") {\r\n\r\n                    rollCallLog.splice(index, 2, rollCallLog[index + 1], rollCallLog[index]);\r\n\r\n                }\r\n\r\n            },\r\n            changeServiceRogTurn: function (index, kind) {\r\n\r\n                var serviceLog = this.data.log.service;\r\n\r\n                if (kind == \"up\") {\r\n\r\n                    serviceLog.splice(index - 1, 2, serviceLog[index], serviceLog[index - 1]);\r\n\r\n                } else if (kind == \"down\") {\r\n\r\n                    serviceLog.splice(index, 2, serviceLog[index + 1], serviceLog[index]);\r\n\r\n                }\r\n\r\n            },\r\n            addServiceMeisai: function () {\r\n\r\n                var driver = this.getDriver(this.data.log.driverID);\r\n                var vehicleID = driver.VehicleID;\r\n                var destinationID = driver.DestinationID;\r\n\r\n\r\n                this.data.log.service.push({\r\n                    ServiceLog: {\r\n                        DestinationID: destinationID,\r\n                        VehicleID: vehicleID,\r\n                        CompanyID: this.data.companyID,\r\n                        EditorID: this.data.editorID,\r\n                        ServiceLogID: -1,\r\n                        DriverID: this.data.log.driverID,\r\n                        ServiceDate: this.data.log.serviceDate\r\n                    }, RollCallLog: [{\r\n                        RollCallLogID: -1,\r\n                        CompanyID: this.data.companyID,\r\n                        EditorID: this.data.editorID\r\n                    }]\r\n                });\r\n\r\n\r\n            },\r\n            remobeServiceMeisai: function (ServiceLogIndex) {\r\n\r\n                if (window.confirm(\"削除しますか？\")) {\r\n\r\n                    if (this.data.log.service[ServiceLogIndex].ServiceLog.ServiceLogID != -1) {\r\n\r\n\r\n                        this.data.log.deletes.ServiceLogs.push(this.data.log.service[ServiceLogIndex].ServiceLog);\r\n\r\n                        for (var i in this.data.log.service[ServiceLogIndex].RollCallLog) {\r\n\r\n                            this.data.log.deletes.RollCallLogs.push(this.data.log.service[ServiceLogIndex].RollCallLog[i]);\r\n\r\n                        }\r\n                    } \r\n\r\n                    this.data.log.service.splice(ServiceLogIndex, 1);\r\n\r\n                }\r\n\r\n            },\r\n            addRollCallMeisai: function (ServiceLogIndex) {\r\n\r\n                this.data.log.service[ServiceLogIndex].RollCallLog.push({\r\n                    CompanyID: this.data.companyID,\r\n                    EditorID: this.data.editorID,\r\n                    RollCallLogID: -1\r\n                });\r\n\r\n            },\r\n            removeRollCallMeisai: function (ServiceLogIndex, RollCallLogIndex) {\r\n\r\n                if (window.confirm(\"削除しますか？\")) {\r\n\r\n                    if (this.data.log.service[ServiceLogIndex].RollCallLog[RollCallLogIndex].RollCallLogID != -1) {\r\n\r\n                        this.data.log.deletes.RollCallLogs.push(this.data.log.service[ServiceLogIndex].RollCallLog[RollCallLogIndex]);\r\n                    }\r\n                    console.log(this.data.log.deletes);\r\n                    this.data.log.service[ServiceLogIndex].RollCallLog.splice(RollCallLogIndex, 1);\r\n\r\n                }\r\n\r\n            },\r\n            search: function (initFlag) {\r\n\r\n                this.$refs['searchForm'].validate((valid) => {\r\n\r\n                    if (valid) {\r\n\r\n                        if (this.data.isSearch) {\r\n\r\n                            if (!initFlag) {\r\n                                if (!window.confirm(\"点呼記録が保存されませんがよろしいですか？\")) {\r\n                                    return false;\r\n                                }\r\n                            } \r\n                            \r\n                        }\r\n\r\n                        this.init();\r\n\r\n                        this.getRollCallLogsInput(initFlag);\r\n\r\n                    }\r\n                })\r\n\r\n            },\r\n            init: function () {\r\n\r\n                this.$set(this.data.log, \"service\", []);\r\n\r\n            },\r\n            initInput: function () {\r\n\r\n                if (!window.confirm(\"点呼記録が保存されませんがよろしいですか？\")) {\r\n                    return false;\r\n                }\r\n                this.init();\r\n                this.data.isSearch = false;\r\n\r\n            },\r\n            getRollCallLogsInput: function (initFlag) {\r\n\r\n                axios.get(url.ApiUrl().GetRollCallLogInputs([{ key: \"MemberID\", value: this.data.search.model.MemberID }, { key: \"ServiceDate\", value: this.data.search.model.ServiceDate }]))\r\n                    .then(response => {\r\n\r\n                        this.data.log.driverID = this.data.search.model.MemberID;\r\n                        this.data.log.driverName = this.getDriver(this.data.search.model.MemberID).MemberName;\r\n                        this.data.log.serviceDate = this.data.search.model.ServiceDate;\r\n                        console.log(response.data);\r\n                        if (response.data.length == 0) {\r\n\r\n                            this.addServiceMeisai();\r\n\r\n                        } else {\r\n\r\n                            this.$set(this.data.log, \"service\", response.data);\r\n\r\n\r\n                        }\r\n\r\n                        this.data.isSearch = true;\r\n                        console.log(initFlag);\r\n                        if (initFlag) {\r\n                            this.$store.commit('changeMoveRollCallLogInput', { ServiceDate: \"\", MemberID: \"\" });\r\n\r\n                        }\r\n\r\n                    })\r\n                    .catch(response => {\r\n                        this.data.isSearch = false;\r\n                    })\r\n\r\n\r\n\r\n            },\r\n            save: function () {\r\n\r\n\r\n                this.$refs['logForm'].validate((valid) => {\r\n\r\n                    if (valid) {\r\n\r\n\r\n                        for (var i in this.data.log.service) {\r\n\r\n                            var beforDrivingRollCallLogCount = 0;\r\n                            var afterDrivingRollCallLogCount = 0;\r\n\r\n                            \r\n\r\n                            for (var k in this.data.log.service[i].RollCallLog) {\r\n\r\n                                if (this.data.log.service[i].RollCallLog[k].RollCallKind == 0) {\r\n\r\n                                    beforDrivingRollCallLogCount++;\r\n\r\n                                } else if (this.data.log.service[i].RollCallLog[k].RollCallKind == 1) {\r\n\r\n                                    afterDrivingRollCallLogCount++;\r\n                                }\r\n\r\n\r\n                            }\r\n\r\n                            console.log(beforDrivingRollCallLogCount, afterDrivingRollCallLogCount);\r\n\r\n                            if (beforDrivingRollCallLogCount >= 2 || afterDrivingRollCallLogCount >= 2) {\r\n\r\n                                alert(\"乗務前点呼及び乗務後点呼は2つ以上登録できません\");\r\n\r\n                                return false;\r\n                            }\r\n\r\n                        }\r\n\r\n\r\n\r\n                        this.data.isSave = true;\r\n                        axios.post(url.ApiUrl().RollCallLogInputsSave(), this.data.log.service)\r\n                            .then(response => {\r\n\r\n                                if (response.data) {\r\n\r\n\r\n                                    axios.put(url.ApiUrl().RollCallLogInputsDelete(), this.data.log.deletes)\r\n                                        .then(response => {\r\n\r\n                                            if (response.data) {\r\n\r\n                                                this.$message({\r\n                                                    message: '登録に成功しました',\r\n                                                    type: 'success'\r\n                                                });\r\n\r\n                                            } else {\r\n\r\n                                                this.$message({\r\n                                                    message: '登録に失敗しました',\r\n                                                    type: 'error'\r\n                                                });\r\n\r\n                                            }\r\n\r\n\r\n                                            this.data.isSave = false;\r\n\r\n                                        })\r\n                                        .catch(response => {\r\n                                            this.$message({\r\n                                                message: '通信に失敗しました',\r\n                                                type: 'error'\r\n                                            });\r\n\r\n                                            this.data.isSave = false;\r\n\r\n                                        });\r\n\r\n\r\n       \r\n                                } else {\r\n\r\n                                    this.$message({\r\n                                        message: '登録に失敗しました',\r\n                                        type: 'error'\r\n                                    });\r\n\r\n                                }\r\n\r\n \r\n                            })\r\n                            .catch(response => {\r\n                                this.$message({\r\n                                    message: '通信に失敗しました',\r\n                                    type: 'error'\r\n                                });\r\n\r\n\r\n                                this.data.isSave = false;\r\n\r\n                            });\r\n\r\n                    }\r\n                })\r\n\r\n            }\r\n\r\n        },\r\n        created: function () {\r\n\r\n            this.data.companyID = this.$store.state.login.companyID;\r\n            this.data.editorID = this.$store.state.login.userID;\r\n\r\n            this.data.search.model.ServiceDate = time.nowJapanDateInput();\r\n\r\n            axios.get(url.ApiUrl().GetRollCallLogInputMasterData([{ key: \"CompanyID\", value: this.data.companyID }]))\r\n                .then(response => {\r\n\r\n                    this.$set(this.data, \"drivers\", response.data.Drivers);\r\n                    this.$set(this.data, \"rollcallers\", response.data.RollCallers);\r\n                    this.$set(this.data, \"destinations\", response.data.Destinations);\r\n                    this.$set(this.data, \"vehicles\", response.data.Vehicles);\r\n                    this.$set(this.data, \"rollcallmethods\", response.data.RollCallMethods);\r\n                    this.$set(this.data, \"diseases\", response.data.Diseases);\r\n                    this.$set(this.data, \"instructions\", response.data.Instructions);\r\n\r\n                    console.log(this.data.drivers);\r\n\r\n                    if (this.$store.state.moveRollCallLogInput.ServiceDate != \"\") {\r\n\r\n                        this.data.search.model.ServiceDate = this.$store.state.moveRollCallLogInput.ServiceDate;\r\n                        this.data.search.model.MemberID = this.$store.state.moveRollCallLogInput.MemberID;\r\n\r\n                        this.search(true);\r\n\r\n\r\n                    }\r\n\r\n                })\r\n                .catch(response => console.log(response))\r\n\r\n  \r\n\r\n\r\n        },\r\n        mounted: function () {\r\n\r\n \r\n        },\r\n        watch: {\r\n        }\r\n    }\r\n</script>\r\n"]}]}